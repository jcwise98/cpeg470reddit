<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="index.css">
  <title>Reddit</title>

  <!-- update the version number as needed
  <script defer src="/__/firebase/7.2.2/firebase-app.js"></script>
  <!-- include only the Firebase features as you need
  <script defer src="/__/firebase/7.2.2/firebase-auth.js"></script>
  <script defer src="/__/firebase/7.2.2/firebase-database.js"></script>
  <script defer src="/__/firebase/7.2.2/firebase-messaging.js"></script>
  <script defer src="/__/firebase/7.2.2/firebase-storage.js"></script>
  <!-- initialize the SDK after all desired features are loaded
  <script defer src="/__/firebase/init.js"></script>-->

  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-database.js"></script>
</head>

<body style="background-color:#F2F1F2">


  <nav class="navbar navbar-light" style="background-color:#1F0425">

    <div class="container-fluid">

      <div class="navbar-header">

        <a class="navbar-brand" <title>Reddit</title>
        </a>

        <img src="https://i2.wp.com/pivx.org/wp-content/uploads/2017/01/reddit.png?w=1080&ssl=1" alt="logo"
          class="logo">

      </div>
      <ul class="nav navbar-nav">
        <li class="active"><a href="https://cpeg470-reddit.firebaseapp.com/">Home</a></li>
      </ul>

      <form class="navbar-form navbar-left" action="/action_page.php">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search Reddit" name="search">
        </div>
        <button type="submit" class="btn btn-default"> <img src="https://img.icons8.com/pastel-glyph/2x/search--v2.png"
            alt="logo" class="logoo"></button>
      </form>
      <ul class="nav navbar-nav navbar-right">

        <button class="btn btn-default" onclick="document.getElementById('id01').style.display='block'">Login <img
            src="https://www.pinclipart.com/picdir/middle/200-2008697_account-customer-login-man-user-icon-login-icon.png"
            alt="logo" class="logoo"></button>
        <!-- The Modal -->
        <div id="id01" class="modal">
          <span onclick="document.getElementById('id01').style.display='none'" class="close"
            title="Close Modal">&times;</span>

          <!-- Modal Content -->
          <form class="modal-content animate" action="/action_page.php">
            <div class="imgcontainer">
            </div>

            <div class="container">
              <label for="uname"><b><img
                    src="https://icon-library.net/images/anonymous-avatar-icon/anonymous-avatar-icon-7.jpg" alt="Avatar"
                    class="logo"> Username</b></label>
              <input type="text" placeholder="Enter Username" name="uname" required>

              <label for="psw"><b>Password</b></label>
              <input type="password" placeholder="Enter Password" name="psw" required>

              <button type="submit">Login</button>
              <label>
                <input type="checkbox" checked="checked" name="remember"> Remember me
              </label>
            </div>

            <div class="container" style="background-color:#f1f1f1">
              <button type="button" onclick="document.getElementById('id01').style.display='none'"
                class="cancelbtn">Cancel</button>
              <span class="psw">Forgot <a href="#">password?</a></span>
            </div>
          </form>
        </div>

        <button class="btn btn-default" type="button"
          onclick="document.getElementById('modal-logout').style.display='block'">Logout <img
            src="https://icon-library.net/images/log-out-icon/log-out-icon-10.jpg" alt="logo" class="logoo"></button>
      </ul>

    </div>

  </nav>



  <div class="form-group">
    <input id="createpost" type="text" class="form-control" placeholder="Create Post" name="search">
  </div>
  <button id="postbutton" class="btn btn-default" type="button"
    onclick="document.getElementById('modal-logout').style.display='block'">Post <img
      src="https://icons-for-free.com/iconfiles/png/512/facebook+pencil+write+post+icon-1320166641210096755.png"
      alt="logo" class="logoo"></button>




  <div class="container">

    <div class="column">
      <div id="post_row" class="row">
        <!--<div class="card">
          <span id="post"></span>
          <br>
          <span class="likebtn-wrapper" data-theme="custom" data-icon_l="thmb8-u" data-icon_d="thmb8-d"
            data-icon_l_c_v="#528d41" data-icon_d_c_v="#fb0505" data-white_label="true" data-rich_snippet="true"
            data-identifier="item_1" data-show_like_label="false" data-share_enabled="false"
            data-share_size="small"></span>
          <script>(function (d, e, s) { if (d.getElementById("likebtn_wjs")) return; a = d.createElement(e); m = d.getElementsByTagName(e)[0]; a.async = 1; a.id = "likebtn_wjs"; a.src = s; m.parentNode.insertBefore(a, m) })(document, "script", "//w.likebtn.com/js/w/widget.js");</script>
        </div> -->
      </div>
    </div>
  </div>
</body>
<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyBBj93-0ZUhkz31nT8u-lGD9982zP0Tf1Y",
    authDomain: "cpeg470-reddit.firebaseapp.com",
    databaseURL: "https://cpeg470-reddit.firebaseio.com",
    projectId: "cpeg470-reddit",
    storageBucket: "cpeg470-reddit.appspot.com",
    messagingSenderId: "530492936109",
    appId: "1:530492936109:web:cfeb7b01d2240ae48c1b24"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  let displayPost = function (val, likeNum, id) {
    var likeBtn = document.getElementById('button' + id);
    likeBtn.innerHTML = likeNum;
  }

  let createPost = function (val) {
    var rootRef = firebase.database().ref();
    var nextPost;
    rootRef.child("numPosts").once("value", function (snapshot) {
      var data = snapshot.val();
      data++;
      nextPost = data;
      firebase.database().ref("numPosts").set(nextPost);

      var postsRef = rootRef.child('posts/' + nextPost);
      //var newPostRef = postsRef.push();
      postsRef.update({
        text: val,
        likes: 0,
        id: nextPost
      });
      readPost(val);
    });
  }

  let readPost = function (val, likeNum, id) {
    var parentElement = document.getElementById('post_row');
    var br = document.createElement('br');
    var div = document.createElement('div');
    var span = document.createElement('span');
    var likebtn = document.createElement('button');
    span.innerHTML = val;
    likebtn.innerHTML = likeNum;
    likebtn.setAttribute('style','background-color:#EFF9F8');
    likebtn.setAttribute('class', 'likeButton');
    var deletebtn = document.createElement('button');
    deletebtn.setAttribute('style', 'background-color: #FCC2BB  ');
    deletebtn.setAttribute('class', 'deleteButton');
    deletebtn.innerHTML= "Delete Post";


    likebtn.addEventListener("click", function () {
      firebase.database().ref("posts/" + id + '/likes').set(likeNum + 1);
    });
    div.setAttribute('class', 'card');
    likebtn.id = "button" + id;
    console.log(likebtn.id);

    div.appendChild(likebtn);
    div.appendChild(deletebtn);
    div.appendChild(span);
    parentElement.appendChild(br);
    parentElement.appendChild(div);
  }

  $(postbutton).on("click", function () {
    createPost($('#createpost').val());
  });

  firebase.database().ref("posts").once("value", function (snapshot) {
    let data = snapshot.val();
    snapshot.forEach(function (post) {
      readPost(post.val().text, post.val().likes, post.val().id);
    });
  });
  firebase.database().ref("posts").on("value", function (snapshot) {
    let data = snapshot.val();
    snapshot.forEach(function (post) {
      displayPost(post.val().text, post.val().likes, post.val().id);
    });
  });

</script>

</html>
